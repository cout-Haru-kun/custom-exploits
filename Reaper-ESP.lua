local lplr = game.Players.LocalPlayer
local camera = game:GetService("Workspace").CurrentCamera
local CurrentCamera = workspace.CurrentCamera
local worldToViewportPoint = CurrentCamera.worldToViewportPoint

local HeadOff = Vector3.new(0, 0.5, 0)
local LegOff = Vector3.new(0,3,0)




for i,v in pairs(game.Players:GetChildren()) do
    local BoxOutline = Drawing.new("Square")
    local Box = Drawing.new("Square")
    BoxOutline.Visible = Box.Visible = false -- Toggle visibility to off at start
    BoxOutline.Transparency = Box.Transparency = 1 -- Set to opaque
    BoxOutline.Filled = Box.Filled = false -- Don't fill squares

    -- Thickness of lines
    BoxOutline.Thickness = 3
    Box.Thickness = 1

    -- Colors
    BoxOutline.Color = Color3.new(0,0,0)
    Box.Color = Color3.new(1,1,1)

    esp()
    -- coroutine.wrap(esp)()
end

game.Players.PlayerAdded:Connect(function(v)
    local BoxOutline = Drawing.new("Square")
    local Box = Drawing.new("Square")
    BoxOutline.Visible = Box.Visible = false -- Toggle visibility to off at start
    BoxOutline.Transparency = Box.Transparency = 1 -- Set to opaque
    BoxOutline.Filled = Box.Filled = false -- Don't fill squares

    -- Thickness of lines
    BoxOutline.Thickness = 3
    Box.Thickness = 1

    -- Colors
    BoxOutline.Color = Color3.new(0,0,0)
    Box.Color = Color3.new(1,1,1)

    -- coroutine.wrap(esp)()
end)







function esp()
    game:GetService("RunService").RenderStepped:Connect(function()
        print("test")
        if v.Character ~= nil and v.Character:FindFirstChild("Humanoid") ~= nil and v.Character:FindFirstChild("HumanoidRootPart") ~= nil and v ~= lplr and v.Character.Humanoid.Health > 0 then
            local Vector, onScreen = camera:worldToViewportPoint(v.Character.HumanoidRootPart.Position)

            local RootPart = v.Character.HumanoidRootPart
            local Head = v.Character.Head
            local RootPosition, RootVis = worldToViewportPoint(CurrentCamera, RootPart.Position)
            local HeadPosition = worldToViewportPoint(CurrentCamera, Head.Position + HeadOff)
            local LegPosition = worldToViewportPoint(CurrentCamera, RootPart.Position - LegOff)

            if onScreen then
                BoxOutline.Size = Vector2.new(1000 / RootPosition.Z, HeadPosition.Y - LegPosition.Y)
                BoxOutline.Position = Vector2.new(RootPosition.X - BoxOutline.Size.X / 2, RootPosition.Y - BoxOutline.Size.Y / 2)
                BoxOutline.Visible = true

                Box.Size = Vector2.new(1000 / RootPosition.Z, HeadPosition.Y - LegPosition.Y)
                Box.Position = Vector2.new(RootPosition.X - Box.Size.X / 2, RootPosition.Y - Box.Size.Y / 2)
                Box.Visible = true

                if v.TeamColor == lplr.TeamColor then
                    BoxOutline.Visible = false
                    Box.Visible = false
                else
                    BoxOutline.Visible = true
                    Box.Visible = true
                end

            else
                BoxOutline.Visible = false
                Box.Visible = false
            end
        else
            BoxOutline.Visible = false
            Box.Visible = false
        end
    end)
end