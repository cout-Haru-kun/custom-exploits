---@diagnostic disable: undefined-global
--[[
    TODO

    auto detect team check type
    auto load configuration of gui / configuration menu in gui

]]
print("[REAPER] Starting..")
print("[REAPER] 0%")




-- Load script if local reapervars not set
if not ReaperVars then
    getgenv().ReaperVars = loadstring(game:HttpGet("https://raw.githubusercontent.com/cout-Haru-kun/custom-exploits/main/reaper/ReaperVars.lua"))()
end

-- Check if correctly loaded
if not ReaperVars then
    print("[REAPER] Error on vars load")
    os.exit()
end

-- 1/4 steps done
print("[REAPER] 25%")





-- Load script if local reaperui not set
if not ReaperUI then
    getgenv().ReaperUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/cout-Haru-kun/custom-exploits/main/reaper/ReaperUI.lua"))()
end

-- Check if correctly loaded
if not ReaperUI then
    print("[REAPER] Error on ui load")
    os.exit()
else
    ReaperUI:Load()
end

-- 2/4 steps done
print("[REAPER] 50%")




-- Load script if local reaperui not set
if not ReaperESP then
    getgenv().ReaperESP = loadstring(game:HttpGet("https://raw.githubusercontent.com/cout-Haru-kun/custom-exploits/main/reaper/ReaperESP.lua"))()
end

-- Check if correctly loaded
if not ReaperESP then
    print("[REAPER] Error on esp load")
    os.exit()
end

-- 3/4 steps done
print("[REAPER] 75%")


-- Turn ESP on
ReaperESP:Toggle(true)


-- Add player list to esp
local childrens
if ReaperVars:GetTeamCheckType() == "Permanent" then
    childrens = workspace.MapFolder.Players:GetChildren()
else
    childrens = game.Players:GetChildren()
end

local addedEvent
if ReaperVars:GetTeamCheckType() == "Permanent" then
    addedEvent = workspace.MapFolder.Players.ChildAdded
else
    addedEvent = game.Players.PlayerAdded
end


-- Add player to esp
function AddPlayerToESP(Player)
    if Player.Name ~= game.Players.LocalPlayer.Name and Player:FindFirstChild("HumanoidRootPart") then
        local Color =  Color3.fromRGB(255, 0, 0)
        ReaperESP:Add(Player, {Color = Color})
    end
end

-- Add all existing players
for i,v in pairs(childrens) do
    AddPlayerToESP(v)
end
-- Connect to event for new players
addedEvent:Connect(AddPlayerToESP)


-- 4/4 steps done
print("[REAPER] 100%")