---@diagnostic disable: undefined-global
--[[
    TODO

    esp rework for less things inside

    auto load configuration of gui / configuration menu in gui
    configuration by game detected

    color rainbow
    phantom force esp

    reaper utils - primary part / heads / team check

    reaper ui - add games detected
]]
local localLoad = true
local totalStep = 5
local currentStep = 0
print("[REAPER] Starting..")




-- ============================================================================================================================================================
-- Load script if local reapervars not set
if not ReaperVars then
    if not localLoad then
        getgenv().ReaperVars = loadstring(game:HttpGet("https://raw.githubusercontent.com/cout-Haru-kun/custom-exploits/main/reaper/ReaperVars.lua"))()
    else
        getgenv().ReaperVars = loadfile("custom-exploits/reaper/ReaperVars.lua")()
    end
end
-- Check if correctly loaded
if not ReaperVars then
    print("[REAPER] Error on vars load")
    os.exit()
end
-- Step done
currentStep = currentStep + 1
print("[REAPER] Vars loaded (" .. (math.floor(currentStep / totalStep * 100)) .. "%)")
-- ============================================================================================================================================================





-- ============================================================================================================================================================
-- Load script if local reapervars not set
if not ReaperUtils then
    if not localLoad then
        getgenv().ReaperUtils = loadstring(game:HttpGet("https://raw.githubusercontent.com/cout-Haru-kun/custom-exploits/main/reaper/ReaperUtils.lua"))()
    else
        getgenv().ReaperUtils = loadfile("custom-exploits/reaper/ReaperUtils.lua")()
    end
end
-- Check if correctly loaded
if not ReaperUtils then
    print("[REAPER] Error on utils load")
    os.exit()
end
-- Step done
currentStep = currentStep + 1
print("[REAPER] Utils loaded (" .. (math.floor(currentStep / totalStep * 100)) .. "%)")
-- ============================================================================================================================================================





-- ============================================================================================================================================================
-- Load script if local reaperui not set
if not ReaperUI then
    if not localLoad then
        getgenv().ReaperUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/cout-Haru-kun/custom-exploits/main/reaper/ReaperUI.lua"))()
    else
        getgenv().ReaperUI = loadfile("custom-exploits/reaper/ReaperUI.lua")()
    end
end

-- Check if correctly loaded
if not ReaperUI then
    print("[REAPER] Error on ui load")
    os.exit()
else
    ReaperUI:Load()
end
-- Step done
currentStep = currentStep + 1
print("[REAPER] UI loaded (" .. (math.floor(currentStep / totalStep * 100)) .. "%)")
-- ============================================================================================================================================================









-- ============================================================================================================================================================
-- Load script if local reaperui not set
if not ReaperESP then
    if not localLoad then
        getgenv().ReaperESP = loadstring(game:HttpGet("https://raw.githubusercontent.com/cout-Haru-kun/custom-exploits/main/reaper/ReaperESP.lua"))()
    else
        getgenv().ReaperESP = loadfile("custom-exploits/reaper/ReaperESP.lua")()
    end
end

-- Check if correctly loaded
if not ReaperESP then
    print("[REAPER] Error on esp load")
    os.exit()
end
-- Step done
currentStep = currentStep + 1
print("[REAPER] ESP loaded (" .. (math.floor(currentStep / totalStep * 100)) .. "%)")
-- ============================================================================================================================================================










-- ============================================================================================================================================================
-- Turn ESP on
ReaperESP:Toggle(true)


-- Add player to esp
function AddPlayerToESP(Player)
    if Player.Name ~= game.Players.LocalPlayer.Name then
        local Color = Color3.fromRGB(255, 0, 0)
        ReaperESP:Add(Player, {Color = Color})
    end
end


-- Hook to event for new players
if ReaperVars:GetDetectedGame() == "Rush Point" then
    workspace.MapFolder.Players.ChildAdded:Connect(AddPlayerToESP)
else
    game.Players.ChildAdded:Connect(AddPlayerToESP)
end

-- Add all players (players already created are automatically removed then re-added)
coroutine.wrap(function()
    -- Run while esp as not been destroyed
    while ReaperESP do
        -- Rush point bodies
        if ReaperVars:GetDetectedGame() == "Rush Point" then
            for _,v in pairs(workspace.MapFolder.Players:GetChildren()) do
                AddPlayerToESP(v)
            end
        -- Phantom force bodies
        elseif ReaperVars:GetDetectedGame() == "Phantom Force" then
            for _,v in pairs(workspace.Players:GetChildren()) do
                for i2,v2 in pairs(v) do
                    AddPlayerToESP(v2)
                end
            end
        -- Common bodies
        else
            for _,v in pairs(game.Players:GetChildren()) do
                AddPlayerToESP(v)
            end
        end
        wait(1)
    end
end)()
-- Step done
currentStep = currentStep + 1
print("[REAPER] Reaper loaded (" .. (math.floor(currentStep / totalStep * 100)) .. "%)")
-- ============================================================================================================================================================